!function(){function t(t){return t&&t.__esModule?t.default:t}var e,o,r,n=!1;function i(t){for(var e=Object.keys(t),r=0;r<e.length;r++)o[e[r]]=t[e[r]]}function s(t){var e=o[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}function a(){return n||(n=!0,o={},(e={}).register=i,r=s,e.resolve=r),e}a().register(JSON.parse('{"2iOfK":"index.2ab97860.js","6dgda":"sw.js","1w89Q":"index.2e5c29ab.css"}'));var l,d,c=!1;function h(){return d||(d=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return(""+t[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),d}function u(){return c||(c=!0,d=null,(l={}).getBundleURL=h),l}var p,g,m,y,f=!1;function b(t){if(""===t)return".";var e="/"===t[t.length-1]?t.slice(0,t.length-1):t,o=e.lastIndexOf("/");return-1===o?".":e.slice(0,o)}function v(t,e){if(t===e)return"";var o=t.split("/");"."===o[0]&&o.shift();var r,n,i=e.split("/");for("."===i[0]&&i.shift(),r=0;(r<i.length||r<o.length)&&null==n;r++)o[r]!==i[r]&&(n=r);var s=[];for(r=0;r<o.length-n;r++)s.push("..");return i.length>n&&s.push.apply(s,i.slice(n)),s.join("/")}function w(){return f||(f=!0,p={},g=a().resolve,p=function(t,e){return v(b(g(t)),g(e))},m=b,p._dirname=m,y=v,p._relative=y),p}var $,E=!1;var C,k={};class A{constructor(t){"string"==typeof t&&(t=document.querySelector(t)),this.$el=t}exists(){return!!this.$el}get(){return this.$el}show(t){return this.$el.style.display=t||"block",this}showInline(){return this.$el.style.display="inline",this}hide(){return this.$el.style.display="none",this}disable(){return this.$el.disabled=!0,this}enable(){return this.$el.disabled=!1,this}style(t,e){return this.$el.style[t]=e,this}addClass(t){return this.$el.className+=` ${t}`,this}removeClass(t){return this.$el.className=this.$el.className.replace(t,"").replace("  "," "),this}remove(){return this.$el.parentNode.removeChild(this.$el),this}setRandomBackground({path:t="",range:e=[0,5],length:o=3,ext:r="jpg"}){const[n,i]=e,s=Math.round(Math.random()*(i-n)+n),a=("0".repeat(o)+s).substr(-o);this.$el.style.backgroundImage=`url(${t}/${a}.${r})`}appear(){return this.style("opacity",1),this}focus(){return this.$el.focus(),this}html(t){return void 0===t?this.$el.innerHTML:(this.$el.innerHTML=t,this)}appendHtml(t){return this.$el.innerHTML+=t,this}prependHtml(t){return this.$el.innerHTML=t+this.html(),this}val(t){return void 0===t?this.$el.value:(this.$el.value=t,this)}clear(){return this.$el.value="",this}isVisible(){return""===this.$el.style.display||this.$el.style.display.match(/(block|inline|inline-block)/)}toggle(){return this.isVisible()?(this.hide(),this):(this.show(),this)}caretEnd(){if(this.$el.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(this.$el),t.collapse(!1);var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}else if(void 0!==document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(this.$el),o.collapse(!1),o.select()}return this}src(t){return this.$el.src=t,this}scrollBottom(){return this.$el.scrollTop=this.$el.scrollHeight,this}on(t,e){return this.$el.addEventListener(t,e),this}static injectStyles(t){const e=document.createElement("style");e.type="text/css",e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e)}}
/*!
  * Prophetjs v0.0.9
  * Copyright 2016 Amin Mohamed Ajani (http://allrightamin.xyz, http://twitter.com/AminSpeaks)
  * Open source under the MIT License (https://github.com/binarybaba/prophetjs/blob/master/LICENSE)
  * All rights reserved.
  */Date.now||(Date.now=function(){return(new Date).getTime()});class T{constructor(t){this.app=t}channel({type:t,data:e,error:o}){if(this.log("channel:",e),o)throw new Error(o);e&&e.buttons&&e.buttons.length?e.buttons.map((t=>{console.log("button:",t);const e=this.app.addButton(null,t);this.app.addAudio(e,t)})):this.log("EMPTY channel")}buttonSaved({type:t,data:e,error:o}){o?this.log("ERROR SAVING BUTTON",o):this.log("BUTTON SAVED",e)}log(){console.log("[ EVENTS ]--\x3e",...arguments)}play({type:t,data:e,error:o}){const{channel:r,id:n,src:i}=e;if(this.log(`BROADCAST PLAY @${r}:`,i),this.app.channel!==r)return;if(this.app.playing||this.app.recording)return;const s=new El(`#btn-${n}`);s.exists()&&(this.app.$audio.src=i,this.app.$audio.play(),s.addClass("playing"),setTimeout((()=>{this.log("BROADCAST PLAYING stopped"),s.removeClass("playing")}),this.app.recordingTime))}}Array.prototype.map||(Array.prototype.map=function(t,e){var o,r,n;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(o=e),r=new Array(s),n=0;n<s;){var a,l;n in i&&(a=i[n],l=t.call(o,a,n,i),r[n]=l),n++}return r}),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&(C=Object.getOwnPropertyDescriptor(Element.prototype,"innerText"),Object.defineProperty(Element.prototype,"textContent",{get:function(){return C.get.call(this)},set:function(t){return C.set.call(this,t)}}));!function(){function t(e,o,r){return this._text=e||"Awesome!",this._id=t.idGen(),this._type="default",this._duration=4e3,this._class=" ",o&&(this.cb=r,"function"==typeof o?this.cb=o:"object"!=typeof o||Array.isArray(o)||(this._type=o.type||this._type,this._id=o.id||this._id,this._duration=o.duration||this._duration,this._class=o.class||this._class)),this.cb="function"==typeof o?o:r,t.Stack[t.Stack.length]=this,this.init(),this}t.idGen=function(){return Date.now()%1e4},t.clearAll=function(){for(var e=document.querySelectorAll("ul.prophet > li"),o=0,r=e.length;o<r;o++)e[o].classList.remove("prophet-message-active"),t.parent.removeChild(e[o])},t.prototype.init=function(){var e=this;this.cbFired=!1,this.toast=document.createElement("li");var o,r=this.toast;o=["message "+this._class,this._text],r.className=o[0],r.textContent=o[1],this.stylize(),r.addEventListener("click",(function(){r.classList.remove("prophet-message-active"),e.cb&&(e.cb(e._id),e.cbFired=!0),setTimeout((function(){t.parent.removeChild(r)}),60)}))},t.prototype.show=function(){var e=this,o=this.toast;return t.parent.appendChild(this.toast),setTimeout((function(){o.classList.add("prophet-message-active")}),10),setTimeout((function(){o.classList.remove("prophet-message-active"),e.cbFired||e.cb&&e.cb(e._id),setTimeout((function(){try{t.parent.removeChild(o)}catch(t){}}),30)}),this._duration),this},t.prototype.stylize=function(){var e=t.Util.find(t.stylePresets,this._type);-1!==e&&(this.toast.style.backgroundColor=t.stylePresets[e].backgroundColor,this.toast.style.color=t.stylePresets[e].color)},t.Util={find:function(t,e){return t.map((function(t){return t.type})).indexOf(e)},toDash:function(t){return t.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()}))},getSizes:function(){var t,e;return void 0!==window.innerWidth?(t=window.innerWidth,e=window.innerHeight):void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(t=document.getElementsByTagName("body")[0].clientWidth,e=document.getElementsByTagName("body")[0].clientHeight),{width:t,height:e}},rePosition:function(){var e=t.Util.getSizes().width,o=(t.Util.getSizes().height,document.getElementsByClassName("prophet")[0]);e<240?o.style.marginLeft="10px":e>240&&e<320?o.style.marginLeft=.3*e+"px":e>320&&e<480?o.style.marginLeft=.35*e+"px":e>480&&e<600?o.style.marginLeft=.5*e+"px":e>600&&e<720?o.style.marginLeft=.6*e+"px":e>720&&e<1024?o.style.marginLeft=.7*e+"px":(e>1024||e>1024)&&(o.style.marginLeft=.75*e+"px")}},t.Dbg={stackTrace:function(){return console.dir(t.Stack)},presets:function(){return console.dir(t.stylePresets)}},t.parent=document.getElementsByClassName("prophet")[0],t.stylePresets=[{type:"default",backgroundColor:"#1c2e2d",color:"#FAFAFA"},{type:"success",backgroundColor:"#4daf7c",color:"#FAFAFA"},{type:"error",backgroundColor:"#D45A43",color:"#FAFAFA"}],t.config={types:function(e){for(var o,r=0,n=(e=[].concat(e)).length;r<n;r++){var i=t.Util.find(t.stylePresets,e[r].type);if(o=e[r],-1!==i)for(var s in o)t.stylePresets[i][s]=o[s];else t.stylePresets[t.stylePresets.length]=o}}},t.Stack=[]}();var P=t(k);function L(){console.log("[ APP ]--\x3e",...arguments)}"serviceWorker"in navigator&&navigator.serviceWorker.register((E||(E=!0,$={},$=u().getBundleURL()+w()("2iOfK","6dgda")),$)).then((function(){console.log("Service Worker Registered")}));new class{constructor(t){this.$buttons=new A("#buttons"),this.$audio=document.querySelector("audio"),this.$addButton=new A("#add"),this.$error=new A("#error"),this.$drop=new A("#drop"),this.dragTimeout,this.audioCollection={},this.recorder=null,this.recordingTime=3e3,this.dropAudioDurationLimit=this.recordingTime/1e3,this.channel=this.getChannelName(),this.url=location.href,this.colors=["color1","color2","color3","color4","color5","color6","color7","color8"],this.downloadLink=document.querySelector("#download"),this.messages={noAudioRecording:"Your browser does not support audio recording, sorry.",noWebSocketSupport:"InstaBuddy is not fully supported on your browser. Please, try with latest Chrome or Firefox :)",notSupported:"InstaBuddy is not fully supported on your browser. Please, try with latest Chrome or Firefox :)",noAudioPlayback:"Audio playback is not supported on your browser. Please, try with latest Chrome or Firefox :)"},this.alerts={playbackError:new P("Oops, playback failed.",{type:"error"}),playbackNotFoundError:new P("Error: Audio source not found.",{type:"error"}),playbackErrorRepeated:new P("\n        Playback failed several times. Maybe your browser does not support webm audio.\n      ",{type:"error"}),clipboardCopyOk:new P("Copied to clipboard!",{type:"success"}),noAudioPlayback:new P("Audio playback is not supported on your browser.",{type:"error"}),notAudioFile:new P("Not an audio file.",{type:"error"}),audioTooLarge:new P("Exceeds 3s limit.",{type:"error"})},this.playing=!1,this.recording=!1,this.connected=!1,this.mode=t,this.init()}init(){"normal"===this.mode&&(this.initRecording(),this.initClipboard()),this.connect((()=>{this.events=new T(this),"standalone"!==this.mode&&this.getChannel()})),this.supportsWebm()||this.alerts.noAudioPlayback.show(),this.setDrop()}supportsWebm(){return!!this.$audio.canPlayType("audio/webm")}initClipboard(){if(!Clipboard.isSupported())return;new Clipboard("i.share").on("success",(t=>{this.alerts.clipboardCopyOk.show()}))}initRecording(){try{navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{try{this.recorder=new MediaRecorder(t)}catch(t){this.handleError("noAudioRecording",t)}})).catch((t=>{this.handleError("noAudioRecording",t)}))}catch(t){this.handleError("noAudioRecording",t)}}getChannelName(){return location.pathname.match("play")?location.pathname.match(/channel\/(.*?)\//)[1]:location.pathname.replace("/channel/","")}handleError(t,e){({noAudioRecording:()=>{L(e),"normal"===this.mode&&this.$addButton.hide(),alert(this.messages.noAudioRecording)},noWebSocketSupport:()=>{L(e),alert(this.messages.noWebSocketSupport)},noAudioPlayback:()=>{L(e),alert(this.messages.noAudioPlayback),this.$buttons.hide(),this.showError(this.messages.noAudioPlayback)}}[t]||(()=>{alert(this.messages.notSupported)}))()}showError(t){this.$error.html(t).show()}connect(t){if(!1 in window)return void alert(this.messages.noWebSocketSupport);let e="ws";"https:"===location.protocol&&(e="wss"),this.ws=new ReconnectingWebSocket(`${e}://${location.host}`),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{this.connected?L("WebSocket reconnected."):(L("WebSocket connected."),this.connected=!0,"function"==typeof t&&t())},this.ws.onmessage=t=>{const{type:e,data:o,error:r}=JSON.parse(t.data);L(`Got message '${e}'`,o,r),"function"==typeof this.events[e]&&this.events[e]({type:e,data:o,error:r})},this.ws.onerror=t=>{L("ERROR:",t)}}send(t){const e=JSON.stringify(t);this.ws.send(e)}getChannel(){L("Get channel..."),this.send({type:"getChannel",name:this.channel})}onButtonClick(t){if("share"===t.target.className&&!Clipboard.isSupported())return void this.openButtonUrl(t.target);const e=t.target.dataset.id;return e?this.audioCollection[e].src?this.play(e):void this.record(e,t):void 0}openButtonUrl(t){const e=t.dataset["clipboard-text"];e&&window.open(e)}record(t,e){if(this.recording)return;this.recording=!0,L("recording started",t);const o=new A(e.target);o.addClass("recording");const r=[];this.recorder.start(),this.recorder.ondataavailable=e=>{if(r.push(e.data),"inactive"!==this.recorder.state)return;const o=new Blob(r,{type:"audio/webm"});this.audioCollection[t].src=URL.createObjectURL(o),this.saveButton(this.audioCollection[t])},setTimeout((()=>{this.recorder.stop(),L("recording stopped",t),o.removeClass("recording"),o.removeClass("empty"),this.recording=!1}),this.recordingTime)}sendBinary(t,{id:e,name:o,channel:r}){const n=new XMLHttpRequest,i=`/binary/${r}/${e}/${o}`;n.open("POST",i,!0),n.send(t)}saveButton(t){fetch(t.src).then((e=>{e.arrayBuffer().then((e=>{const o={id:t.id,name:t.name,channel:this.channel};this.sendBinary(e,o)}))}))}play(t){if(this.playing||this.recording)return;L("play",t),this.playing=!0;const e=new A(`#btn-${t}`);e.addClass("playing");let o=this.audioCollection[t].src;this.$audio.src=o;const r=setTimeout((()=>{L("playing stopped"),e.removeClass("playing"),this.playing=!1}),this.recordingTime);this.sendPlay(t,o);try{this.$audio.play().then((()=>{})).catch((t=>{L("Playback ERROR:",t),"The operation is not supported."!==t.message&&("Failed to load because no supported source was found."!==t.message?this.handlePlaybackError("playbackError",e,r):this.handlePlaybackError("playbackNotFoundError",e,r))}))}catch(n){L(`ERROR PLAYING '${t}': ${o}`,n),this.handlePlaybackError("playbackError",e,r)}}handlePlaybackError(t,e,o){this.alerts[t].show(),clearTimeout(o),e.removeClass("playing"),this.playing=!1}sendPlay(t,e){this.send({type:"play",data:{channel:this.channel,id:t,src:e}})}download(t,e){t.stopPropagation(),t.preventDefault(),this.downloadLink.href=this.audioCollection[e].src,this.downloadLink.download=this.audioCollection[e].name.replace(" ","-")+".webm",this.downloadLink.click()}onKey(t){}onDrag(t){if(t.preventDefault(),t.stopPropagation(),!this.dragging)return clearTimeout(this.dragTimeout),this.$drop.show("flex"),this.dragging=!0,setTimeout((()=>this.dragging=!1),70),!1}onDragEnter(t){return t.preventDefault(),t.stopPropagation(),!1}onDragLeave(t){return t.preventDefault(),t.stopPropagation(),clearTimeout(this.dragTimeout),this.dragTimeout=setTimeout((()=>this.$drop.hide()),100),!1}onDrop(t){if(t.stopPropagation(),t.preventDefault(),this.$drop.hide(),t.dataTransfer.items){const e=Array.from(t.dataTransfer.files);if(0===e.length)return void L("No files available.");t.dataTransfer.dropEffect="copy",e.map((t=>this.addDroppedAudio(t)))}return!1}addDroppedAudio(t){if(!t.type.match(/audio/))return void this.alerts.notAudioFile.show();const e=window.URL.createObjectURL(t),o=new Audio;o.addEventListener("loadedmetadata",(r=>{if(o.duration>this.dropAudioDurationLimit)return console.error(`Audio duration is more than ${this.dropAudioDurationLimit} seconds.`),void this.alerts.audioTooLarge.show();const n=(new Date).getTime();this.addButton(null,{id:n,name:t.name}),this.audioCollection[n].src=e,this.saveButton(this.audioCollection[n])})),o.src=e}setDrop(){document.body.addEventListener("dragenter",(t=>this.onDragEnter(t)),!1),document.body.addEventListener("dragover",(t=>this.onDrag(t)),!1),document.body.addEventListener("dragleave",(t=>this.onDragLeave(t)),!1),document.body.addEventListener("drop",(t=>this.onDrop(t)),!1)}getRandomColor(){const t=this.colors.length,e=Math.round(Math.random()*t);return this.colors[e]}removeButton(t,e){if(t.stopPropagation(),!confirm("Delete this InstantButton?"))return;new A(`#btn-${e}`).remove(),this.send({type:"removeButton",channel:this.channel,id:e})}addButton(t,e={}){let{id:o,name:r}=e;if(t&&t.stopPropagation(),r=r||prompt("Button name?"),!r||!r.trim())return;const n=o?"":" empty";o=o||(new Date).getTime();const i=`btn-${o}`,s=this.getRandomColor();return this.$buttons.prependHtml(`\n      <div id="${i}" data-id="${o}" class="btn${n} ${s}">\n        <p class="ellipsis">${r}</p>\n        <div class="button-actions">\n          <i title="Download" class="download" onclick="app.download(event, ${o})">💾</i>\n          <i\n            title="Share" class="share"\n            data-clipboard-text="${this.url}/play/${o}"\n          >🔗</i>\n          <i title="Delete" class="remove" onclick="app.removeButton(event, ${o})">⌫</i>\n        </div>\n      </div>\n    `),this.addAudio(o,{id:o,name:r,color:s}),o}getButtonLink(t,e){t.stopPropagation(),t.preventDefault();this.url}addAudio(t,e){this.audioCollection[t]=e}}(mode)}();
//# sourceMappingURL=index.2ab97860.js.map
